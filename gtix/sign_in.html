<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sign In - Barren</title>
    <link rel="icon" type="image/png" href="images/fav.png">

    <!-- All your original CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href='vendor/unicons-2.0.1/css/unicons.css' rel='stylesheet'>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    <link href="css/night-mode.css" rel="stylesheet">
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="vendor/OwlCarousel/assets/owl.carousel.css" rel="stylesheet">
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Your exact original HTML layout -->
<div class="form-wrapper">
    <div class="app-form">
        <div class="app-form-sidebar">
            <div class="sidebar-sign-logo">
                <img src="images/sign-logo.html" alt="">
            </div>
            <div class="sign_sidebar_text">
                <h1>The Easiest Way to Create Events and Sell More Tickets Online</h1>
            </div>
        </div>
        <div class="app-form-content">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-md-10">
                        <div class="app-top-items">
                            <a href="index.html">
                                <div class="sign-logo" id="logo">
                                    <img src="images/logo.svg" alt="">
                                    <img class="logo-inverse" src="images/dark-logo.svg" alt="">
                                </div>
                            </a>
                            <div class="app-top-right-link">
                                New to Barren? <a class="sidebar-register-link" href="sign_up.html">Sign up</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-5 col-lg-6 col-md-7">
                        <div class="registration">
                            <form onsubmit="return false;">
                                <h2 class="registration-title">Sign in to Barren</h2>
                                <div class="form-group mt-5">
                                    <label class="form-label">Your Email*</label>
                                    <input id="email" class="form-control h_50" type="email" placeholder="Enter your email" required>
                                </div>
                                <div class="form-group mt-4">
                                    <label class="form-label">Password*</label>
                                    <div class="loc-group position-relative">
                                        <input id="password" class="form-control h_50" type="password" placeholder="Enter your password" required>
                                        <span class="pass-show-eye"><i class="fas fa-eye-slash"></i></span>
                                    </div>
                                </div>
                                <button class="main-btn btn-hover w-100 mt-4" type="button" onclick="signIn()">
                                    Sign In
                                </button>
                            </form>

                            <div class="new-sign-link mt-4">
                                New to Barren? <a class="signup-link" href="sign_up.html">Sign up</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright-footer">
                © 2024, Barren. All rights reserved.
            </div>
        </div>
    </div>
</div>

<!-- ALL SCRIPTS AT THE BOTTOM -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/auth.js"></script>


<script>
// NO MORE manual supabase calls — use the function from auth.js
document.getElementById("login-form")?.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.querySelector("#email").value.trim();
  const password = document.querySelector("#password").value;

  if (!email || !password) {
    alert("Please fill in both fields");
    return;
  }

  // THIS IS THE ONLY LINE THAT MATTERS NOW
  await window.signInUser({ email, password });
});
</script>

<!-- FULLY SELF-CONTAINED AUTH CODE -->
<!-- <script>
    const supabase = window.supabase.createClient(
        'https://wvkljqiblwpajbaoqviu.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2a2xqcWlibHdwYWpiYW9xdml1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Nzc0MjEsImV4cCI6MjA3OTE1MzQyMX0.BBedIJKfYY26WMPOGqwJOn6dnxSObOGvmIDZRAV5ens'
    );

    // ONLY redirect to index.html if user is ALREADY logged in when the page loads
    supabase.auth.getSession().then(({ data: { session } }) => {
        if (session) location.href = 'index.html';
    });

    async function signIn() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        if (!email || !password) return alert('Please fill both fields');

        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
            alert('Login failed: ' + error.message);
        } else {
            alert('Welcome back!');
            location.href = 'index.html';
        }
    }
</script> -->

</body>
</html>